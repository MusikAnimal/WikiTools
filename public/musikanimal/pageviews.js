!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(){var a=$(z.projectInput).val();return a.replace(/.org$/,"")}function e(a){return"//"+d()+".org/wiki/"+a}function f(){$(z.projectInput).on("change",function(){return this.value?void(g()||k()):void(this.value="en.wikipedia.org")})}function g(){var a=$(z.projectInput).val();return-1===sites.indexOf(a)?(o("<a href='//"+a+"'>"+a+"</a> is not a <a href='https://en.wikipedia.org/w/api.php?action=sitematrix&formatversion=2'>valid project</a>","validate",!0),k(),$(".select2-selection--multiple").addClass("disabled"),!0):($(".validate").remove(),void $(".select2-selection--multiple").removeClass("disabled"))}function h(){var a=$(z.dateRangeSelector);a.daterangepicker({startDate:moment().subtract(z.daysAgo,"days"),minDate:z.minDate,maxDate:z.maxDate}),a.on("change",m)}function i(){var a=$(z.articleSelector);a.select2({placeholder:"Type article names...",maximumSelectionLength:10,ajax:{url:"https://"+d()+".org/w/api.php",dataType:"jsonp",delay:200,jsonpCallback:"articleSuggestionCallback",data:function(a){return{action:"query",list:"prefixsearch",format:"json",pssearch:a.term||"",cirrusUseCompletionSuggester:"yes"}},processResults:function(a){var b=[];return a&&a.query&&a.query.prefixsearch.length&&(b=a.query.prefixsearch.map(function(a){return{id:a.title.replace(/ /g,"_"),text:a.title}})),{results:b}},cache:!0}}),a.on("change",m)}function j(){$(".download-csv").on("click",x),$(".download-json").on("click",y),$("#platform-select, #agent-select").on("change",m)}function k(){var a=$(z.articleSelector);a.off("change"),a.select2("val",null),a.select2("data",null),a.select2("destroy"),$(".data-links").hide(),i(),m()}function l(a){var b=z.articleSelector;a.forEach(function(a){var c=$("<div>").text(a).html();$("<option>"+c+"</option>").appendTo(b)});var c=$(b);c.select2("val",a),c.select2("close")}function m(){p();var a=$(z.dateRangeSelector),b=a.data("daterangepicker").startDate,c=a.data("daterangepicker").endDate,f=$(z.articleSelector).select2("val")||[];z.articleComparisonChart&&(z.articleComparisonChart.destroy(),delete z.articleComparisonChart),f.length?$(".chart-container").addClass("loading"):$("#chart-legend").html("");var g=[],h=[];f.forEach(function(a,i){var j=encodeURIComponent(a),k="https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/"+d()+("/"+$("#platform-select").val()+"/"+$("#agent-select").val()+"/"+j+"/daily")+("/"+b.format(z.timestampFormat)+"/"+c.format(z.timestampFormat));$.ajax({url:k,dataType:"json",success:function(d){n(d,b,c),0===g.length&&(g=d.items.map(function(a){return moment(a.timestamp,z.timestampFormat).format("YYYY-MM-DD")}));var e=d.items.map(function(a){return a.views}),j=z.colors[i];h.push({label:a.replace(/_/g," "),fillColor:"rgba(0,0,0,0)",strokeColor:j,pointColor:j,pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:j,data:e,sum:e.reduce(function(a,b){return a+b})}),window.chartData=h;var k='<b>Totals:</b><ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span class="indic" style="background-color:<%=datasets[i].strokeColor%>"><a href=\'<%= getPageURL(datasets[i].label) %>\'><%=datasets[i].label%></a></span> <%= chartData[i].sum %> (<%= Math.round(chartData[i].sum / numDaysInRange()) %>/day)</li><%}%></ul>';if(h.length===f.length){$(".chart-container").removeClass("loading");var l={labels:g,datasets:h},m={animation:!0,animationEasing:"easeInOutQuart",bezierCurve:!1,legendTemplate:k};$(".chart-container").html(""),$(".chart-container").append("<canvas class='aqs-chart'>");var o=$(z.chart)[0].getContext("2d");z.articleComparisonChart=new Chart(o).Line(l,m),$("#chart-legend").html(z.articleComparisonChart.generateLegend()),$(".data-links").show()}},error:function(b){404===b.status&&($(".chart-container").html(""),$(".chart-container").removeClass("loading"),o("No data found for the page <a href='"+e(a)+"'>"+a+"</a>"))}})})}function n(a,b,c){var d={};a.items.forEach(function(a){var b=moment(a.timestamp,z.timestampFormat);d[b]=a}),a.items=[];for(var e=moment(b);e.isBefore(c);e.add(1,"d"))d[e]?a.items.push(d[e]):e!==c&&a.items.push({timestamp:e.format(z.timestampFormat),views:null})}function o(a,b,c){c&&($(".chart-container").removeClass("loading"),$(".chart-container").html("")),$(".chart-container").append("<p class='"+(b||"")+"'>"+a+"</p>")}function p(){var a=$(z.dateRangeSelector).data("daterangepicker"),b=$(z.articleSelector).select2("val")||[],c=$.param({start:a.startDate.format("YYYY-MM-DD"),end:a.endDate.format("YYYY-MM-DD"),project:$(z.projectInput).val(),platform:$("#platform-select").val(),agent:$("#agent-select").val()})+"&pages="+b.join("|");window.history&&window.history.replaceState&&window.history.replaceState({},"Pageview comparsion","#"+c)}function q(){var a=v();if($(z.projectInput).val(a.project||"en.wikipedia.org"),!g()){var b=moment(a.start||moment().subtract(z.daysAgo,"days")),c=moment(a.end||Date.now());$(z.dateRangeSelector).data("daterangepicker").setStartDate(b),$(z.dateRangeSelector).data("daterangepicker").setEndDate(c),$("#platform-select").val(a.platform||"all-access"),$("#agent-select").val(a.agent||"user"),k(),!a.pages||1===a.pages.length&&!a.pages[0]?(a.pages=["Cat","Dog"],l(a.pages)):A?(a.pages=s(a.pages),l(a.pages)):r(a.pages).then(function(b){A=!0,b.query.normalized&&b.query.normalized.forEach(function(b){a.pages=a.pages.map(function(a){return b.from===a?b.to:a})}),l(s(a.pages))})}}function r(a){return $.ajax({url:"https://"+d()+".org/w/api.php?action=query&prop=info&format=json&titles="+a.join("|"),dataType:"jsonp"})}function s(a){return a.map(function(a){return decodeURIComponent(a.replace(/ /g,"_"))})}function t(){var a=$(z.dateRangeSelector).data("daterangepicker");return a.endDate.diff(a.startDate,"days")+1}function u(){for(var a=$(z.dateRangeSelector).data("daterangepicker"),b=moment(a.startDate),c=[],d=0;d<t();d++)c.push(b.format("YYYY-MM-DD")),b.add(1,"day");return c}function v(){for(var a=decodeURI(location.hash.slice(1)),b=a.split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("=");"pages"===e[0]?c.pages=e[1].split("|"):c[e[0]]=e[1]}return c}function w(a){return a.map(function(a){return a||0})}function x(a){a.preventDefault();var b="data:text/csv;charset=utf-8,Page,Color,Sum,Daily average,",c=[];chartData.forEach(function(a,b){var d=['"'+a.label.replace(/"/g,'""').replace(/'/g,"''")+'"',a.strokeColor,a.sum,Math.round(a.sum/t())].concat(w(a.data)).join(",");c.push(d)}),b=b+u().join(",")+"\n"+c.join("\n");var d=encodeURI(b);window.open(d)}function y(a){a.preventDefault();var b=[];chartData.forEach(function(a,c){var d={page:a.label.replace(/"/g,'"').replace(/'/g,"'"),color:a.strokeColor,sum:a.sum,daily_average:Math.round(a.sum/t())};a.data=w(a.data),u().forEach(function(b,c){d[b.replace(/\\/,"")]=a.data[c]}),b.push(d)});var c="data:text/json;charset=utf-8,"+JSON.stringify(b),d=encodeURI(c);window.open(d)}var z={colors:["#bccbda","#e0ad91","#c1aa78","#8da075","#998a6f","#F24236","#F5F749","#EFBDEB","#2E86AB","#565554"],projectInput:".aqs-project-input",dateRangeSelector:".aqs-date-range-selector",articleSelector:".aqs-article-selector",chart:".aqs-chart",minDate:moment("2015-10-01"),maxDate:moment().subtract(1,"days"),timestampFormat:"YYYYMMDD00",daysAgo:20},A=!1;window.getPageURL=e,window.numDaysInRange=t,$(document).ready(function(){$.extend(Chart.defaults.global,{animation:!1,responsive:!0}),f(),h(),i(),q(),$.ajax({url:"/musikanimal/api/uses",method:"PATCH",data:{tool:"pageviews",type:"form"}}),$(".date-latest a").on("click",function(a){var b=$(z.dateRangeSelector).data("daterangepicker");b.setStartDate(moment().subtract($(this).data("value"),"days")),b.setEndDate(moment()),a.preventDefault()}),j()})},{}]},{},[1]);